{"ast":null,"code":"var _jsxFileName = \"/Users/nathanmajumder/crossword-react-app/crossword-app/src/components/CrosswordBoardApp.jsx\";\nimport React, { Fragment, Component } from 'react';\nimport PropTypes from 'prop-types';\nimport '../css/CrosswordBoardApp.css';\nimport SquareSelection from '../libs/SquareSelection.js';\nimport CrosswordClueScroll from './CrosswordClueScroll.jsx';\nimport CrosswordKeyActions from '../libs/CrosswordKeyActions.js';\nimport api from '../libs/api.js';\n\nclass CrosswordBoardApp extends Component {\n  constructor(props) {\n    super(props);\n    this.acrossClues = this.props.crossword.acrossClues.sort((c1, c2) => c1.number > c2.number ? 1 : -1);\n    this.downClues = this.props.crossword.downClues.sort((c1, c2) => c1.number > c2.number ? 1 : -1);\n    this.clueRefMap = this.props.crossword.clueRefMap;\n    this.board = this.props.crossword.board;\n    let currentSelection = new SquareSelection(this.props.crossword.board.selection.rowCoord, this.props.crossword.board.selection.colCoord, this.props.crossword.board.selection.direction);\n    this.state = {\n      currentSelection: currentSelection,\n      grid: this.board.grid,\n      lastSavedGrid: this.board.grid\n    };\n    this.clueClicked = this.clueClicked.bind(this);\n    this.boardSquareClicked = this.boardSquareClicked.bind(this);\n    this.getSelectedSquares = this.getSelectedSquares.bind(this);\n    this.getReferencedSquares = this.getReferencedSquares.bind(this);\n    this.getSquaresOfClue = this.getSquaresOfClue.bind(this);\n    this.getSquareBackgroundColor = this.getSquareBackgroundColor.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n  }\n\n  componentDidMount() {\n    console.log(\"Crossword Board App is Mounting...\");\n    document.addEventListener(\"keydown\", this.onKeyDown, false);\n  }\n\n  componentWillUnmount() {\n    console.log(\"Crossword Board App is Unmounting...\");\n    document.removeEventListener(\"keydown\", this.onKeyDown, false); // save state of grid\n\n    const {\n      currentSelection,\n      grid\n    } = this.state;\n    this.board.selection.rowCoord = currentSelection.coords[0];\n    this.board.selection.colCoord = currentSelection.coords[1];\n    this.board.selection.direction = currentSelection.direction;\n    this.saveGridState(this.board);\n  }\n\n  async saveGridState(board) {\n    let response;\n    let requestSuccess = false;\n\n    try {\n      console.log('Saving crossword state...');\n      console.log(this.board);\n      response = await api.crosswordIsComplete(this.props.crossword.id, \"ME\", this.board);\n      console.log(response);\n      requestSuccess = response.status === 200;\n    } catch (error) {\n      requestSuccess = false;\n    }\n\n    if (!requestSuccess) {\n      console.log(\"Unable to save state of crossword\");\n    } else {\n      this.setState({\n        lastSavedGrid: this.state.grid\n      });\n    }\n  }\n\n  async crosswordIsComplete(showNotComplete) {\n    let response;\n    let requestSuccess = false;\n\n    try {\n      console.log('Checking whether crossword is finished...');\n      console.log(this.board);\n      response = await api.crosswordIsComplete(this.props.crossword.id, \"ME\", this.board);\n      console.log(response);\n      requestSuccess = response.status === 200;\n    } catch (error) {\n      requestSuccess = false;\n    }\n\n    if (requestSuccess) {\n      if (response.data) {\n        this.props.crosswordFinished();\n      } else {\n        if (showNotComplete) {\n          this.props.crosswordUnfinished();\n        }\n      }\n    }\n  }\n\n  onKeyDown(event) {\n    console.log(event); // if special key pressed, allow default action\n\n    if (event.ctrlKey || event.altKey || event.metaKey) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (this.props.typingDisabled) {\n      return;\n    }\n\n    let selection = this.state.currentSelection;\n\n    if (event.which === 13 || event.which === 9) {\n      // enter or tab\n      selection = CrosswordKeyActions.tabOrEnter(this.state.grid, selection, event.shiftKey, this.acrossClues, this.downClues);\n    } else if (event.which === 8) {\n      // delete\n      selection = CrosswordKeyActions.delete(this.state.grid, selection);\n    } else if (event.which === 37) {\n      // left arrow\n      selection = CrosswordKeyActions.leftArrow(this.state.grid, selection);\n    } else if (event.which === 38) {\n      // up arrow\n      selection = CrosswordKeyActions.upArrow(this.state.grid, selection);\n    } else if (event.which === 39) {\n      // right arrow\n      selection = CrosswordKeyActions.rightArrow(this.state.grid, selection);\n    } else if (event.which === 40) {\n      // down arrow\n      selection = CrosswordKeyActions.downArrow(this.state.grid, selection);\n    } else {\n      let gridWasFull = CrosswordKeyActions.gridIsFull(this.state.grid);\n\n      if (event.which >= 65 && event.which <= 90) {\n        // a to z\n        selection = CrosswordKeyActions.alphaNumeric(this.state.grid, selection, event.key.toUpperCase());\n      } else if (event.which >= 48 && event.which <= 57) {\n        // 0 to 9 or the symbols on the same keys\n        selection = CrosswordKeyActions.alphaNumeric(this.state.grid, selection, event.key);\n      } else if (event.which >= 186 && event.which <= 222) {\n        // various symbols that we want to allow in case of special themed puzzle\n        // disallow the underscore because it is reserved for black squares\n        if (event.key === \"_\") {\n          return;\n        }\n\n        selection = CrosswordKeyActions.alphaNumeric(this.state.grid, selection, event.key);\n      }\n\n      if (CrosswordKeyActions.gridIsFull(this.state.grid)) {\n        this.crosswordIsComplete(!gridWasFull);\n      }\n    }\n\n    this.setState({\n      currentSelection: selection\n    });\n  }\n\n  clueClicked(clue) {\n    let coords = CrosswordKeyActions.getFirstEmptySpace(this.state.grid, clue);\n\n    if (coords === null) {\n      coords = [clue.rowCoord, clue.colCoord];\n    }\n\n    let selection = this.state.currentSelection;\n    selection.coords = coords;\n    selection.direction = clue.direction;\n    this.setState({\n      currentSelection: selection\n    });\n  }\n\n  boardSquareClicked(square) {\n    if (square.value === \"_\") {\n      return;\n    }\n\n    let selection = this.state.currentSelection;\n\n    if (square.rowCoord === selection.coords[0] && square.colCoord === selection.coords[1]) {\n      selection.flipDirection();\n    } else {\n      selection.coords = [square.rowCoord, square.colCoord];\n    }\n\n    this.setState({\n      currentSelection: selection\n    });\n  }\n\n  getSelectedSquares(selection) {\n    const coords = selection.coords;\n    const direction = selection.direction;\n    let boardSquare = this.state.grid[coords[0]][coords[1]];\n    let selectedCoordList = [];\n\n    if (direction === \"Across\") {\n      let clue = this.acrossClues.find(clue => clue.number === boardSquare.acrossClueNum);\n      selectedCoordList = selectedCoordList.concat(this.getSquaresOfClue(clue));\n    } else {\n      let clue = this.downClues.find(clue => clue.number === boardSquare.downClueNum);\n      selectedCoordList = selectedCoordList.concat(this.getSquaresOfClue(clue));\n    }\n\n    return selectedCoordList;\n  }\n\n  getReferencedSquares(selection) {\n    const coords = selection.coords;\n    const direction = selection.direction;\n    let selectedCoordList = [];\n\n    if (direction === \"Across\") {\n      let clueNum = this.state.grid[coords[0]][coords[1]].acrossClueNum;\n      let clueKey = \"A\" + clueNum;\n\n      if (clueKey in this.clueRefMap) {\n        for (let key of this.clueRefMap[clueKey]) {\n          let clue;\n\n          if (key.substring(0, 1) === \"A\") {\n            clue = this.acrossClues.find(clue => clue.number.toString() === key.substring(1, key.length));\n          } else {\n            clue = this.downClues.find(clue => clue.number.toString() === key.substring(1, key.length));\n          }\n\n          selectedCoordList = selectedCoordList.concat(this.getSquaresOfClue(clue));\n        }\n      }\n    } else {\n      let clueNum = this.state.grid[coords[0]][coords[1]].downClueNum;\n      let clueKey = \"D\" + clueNum;\n\n      if (clueKey in this.clueRefMap) {\n        for (let key of this.clueRefMap[clueKey]) {\n          let clue;\n\n          if (key.substring(0, 1) === \"A\") {\n            clue = this.acrossClues.find(clue => clue.number.toString() === key.substring(1, key.length));\n          } else {\n            clue = this.downClues.find(clue => clue.number.toString() === key.substring(1, key.length));\n          }\n\n          selectedCoordList = selectedCoordList.concat(this.getSquaresOfClue(clue));\n        }\n      }\n    }\n\n    return selectedCoordList;\n  }\n\n  getSquaresOfClue(clue) {\n    const [firstRow, firstCol] = [clue.rowCoord, clue.colCoord];\n    let coordList = [];\n\n    if (clue.direction === \"Across\") {\n      for (let i = firstCol; i < firstCol + clue.answerLength; i++) {\n        coordList.push([firstRow, i].toString());\n      }\n    } else {\n      for (let i = firstRow; i < firstRow + clue.answerLength; i++) {\n        coordList.push([i, firstCol].toString());\n      }\n    }\n\n    return coordList;\n  }\n\n  getSquareBackgroundColor(square, selection, highlightedSquares, referencedSquares) {\n    if (square.value === \"_\") return \"black\";\n    let thisSquareKey = [square.rowCoord, square.colCoord].toString();\n\n    if (highlightedSquares.includes(thisSquareKey)) {\n      if (thisSquareKey === selection.coords.toString()) {\n        return this.props.settings.colorScheme.colors[1];\n      } else {\n        return this.props.settings.colorScheme.colors[2];\n      }\n    } else if (referencedSquares.includes(thisSquareKey)) {\n      return this.props.settings.colorScheme.colors[0];\n    }\n\n    return \"white\";\n  }\n\n  render() {\n    const {\n      currentSelection,\n      grid\n    } = this.state;\n    let clueWidthPx = \"\" + (this.props.windowWidthPx - (this.props.boardWidthPx + 160) - 2) + \"px\";\n    const boardPx = this.props.boardWidthPx;\n    const boardSize = this.props.crossword.board.grid.length;\n    const rowPx = boardPx / boardSize;\n    const squarePx = rowPx - 1;\n    const highlightedSquares = this.getSelectedSquares(currentSelection);\n    const referencedSquares = this.getReferencedSquares(currentSelection);\n    const acrossClue = this.acrossClues.find(c => c.number === grid[currentSelection.coords[0]][currentSelection.coords[1]].acrossClueNum);\n    const downClue = this.downClues.find(c => c.number === grid[currentSelection.coords[0]][currentSelection.coords[1]].downClueNum);\n    let squareNumberStyle = {\n      fontSize: `${boardSize > 15 ? \"6pt\" : `${boardSize > 9 ? \"9pt\" : \"16pt\"}`}`,\n      marginLeft: `${boardSize <= 9 ? \"5px\" : \"\"}`,\n      marginTop: `${boardSize <= 9 ? \"4px\" : \"\"}`\n    };\n    let squareValueStyle = {\n      width: squarePx,\n      height: squarePx / 2,\n      marginTop: squarePx * 3 / 10,\n      fontSize: `${boardSize > 15 ? \"13pt\" : `${boardSize > 10 ? \"17pt\" : \"44pt\"}`}`\n    };\n\n    if (boardPx > 700) {\n      // handle bigger board on large screens\n      squareNumberStyle[\"fontSize\"] = `${boardSize > 15 ? \"10pt\" : `${boardSize > 10 ? \"13pt\" : \"22pt\"}`}`;\n      squareValueStyle[\"fontSize\"] = `${boardSize > 15 ? \"20pt\" : `${boardSize > 10 ? \"24pt\" : \"64pt\"}`}`;\n    }\n\n    return /*#__PURE__*/React.createElement(Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"crossword-board-and-clues-wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"crossword-board\",\n      style: {\n        width: boardPx,\n        height: boardPx\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 21\n      }\n    }, grid.map((row, i) => /*#__PURE__*/React.createElement(\"div\", {\n      key: i,\n      style: {\n        height: rowPx\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 29\n      }\n    }, row.map((square, j) => /*#__PURE__*/React.createElement(\"div\", {\n      key: j,\n      className: \"crossword-square\",\n      onClick: () => {\n        this.boardSquareClicked(square);\n      },\n      style: {\n        width: squarePx,\n        height: squarePx,\n        backgroundColor: this.getSquareBackgroundColor(square, currentSelection, highlightedSquares, referencedSquares)\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"board-square-number\",\n      style: squareNumberStyle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 41\n      }\n    }, grid[i][j].number > 0 ? grid[i][j].number : \"\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"board-square-value\",\n      style: squareValueStyle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 41\n      }\n    }, square.value === \"\" || square.value === '_' ? '' : square.value)))))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"crossword-clue-section\",\n      style: {\n        width: clueWidthPx,\n        height: boardPx\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(CrosswordClueScroll, {\n      listTitle: \"Across\",\n      clueList: this.acrossClues,\n      selectedClue: acrossClue,\n      isMatchingDirection: currentSelection.direction === 'Across',\n      clueClicked: this.clueClicked,\n      settings: this.props.settings,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(CrosswordClueScroll, {\n      listTitle: \"Down\",\n      clueList: this.downClues,\n      selectedClue: downClue,\n      isMatchingDirection: currentSelection.direction === 'Down',\n      clueClicked: this.clueClicked,\n      settings: this.props.settings,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 25\n      }\n    }))));\n  }\n\n}\n\nCrosswordBoardApp.propTypes = {\n  crossword: PropTypes.object.isRequired,\n  typingDisabled: PropTypes.bool.isRequired,\n  boardWidthPx: PropTypes.number.isRequired,\n  windowWidthPx: PropTypes.number.isRequired,\n  settings: PropTypes.object.isRequired,\n  crosswordFinished: PropTypes.func.isRequired,\n  crosswordUnfinished: PropTypes.func.isRequired\n};\nexport default CrosswordBoardApp;","map":{"version":3,"sources":["/Users/nathanmajumder/crossword-react-app/crossword-app/src/components/CrosswordBoardApp.jsx"],"names":["React","Fragment","Component","PropTypes","SquareSelection","CrosswordClueScroll","CrosswordKeyActions","api","CrosswordBoardApp","constructor","props","acrossClues","crossword","sort","c1","c2","number","downClues","clueRefMap","board","currentSelection","selection","rowCoord","colCoord","direction","state","grid","lastSavedGrid","clueClicked","bind","boardSquareClicked","getSelectedSquares","getReferencedSquares","getSquaresOfClue","getSquareBackgroundColor","onKeyDown","componentDidMount","console","log","document","addEventListener","componentWillUnmount","removeEventListener","coords","saveGridState","response","requestSuccess","crosswordIsComplete","id","status","error","setState","showNotComplete","data","crosswordFinished","crosswordUnfinished","event","ctrlKey","altKey","metaKey","preventDefault","typingDisabled","which","tabOrEnter","shiftKey","delete","leftArrow","upArrow","rightArrow","downArrow","gridWasFull","gridIsFull","alphaNumeric","key","toUpperCase","clue","getFirstEmptySpace","square","value","flipDirection","boardSquare","selectedCoordList","find","acrossClueNum","concat","downClueNum","clueNum","clueKey","substring","toString","length","firstRow","firstCol","coordList","i","answerLength","push","highlightedSquares","referencedSquares","thisSquareKey","includes","settings","colorScheme","colors","render","clueWidthPx","windowWidthPx","boardWidthPx","boardPx","boardSize","rowPx","squarePx","acrossClue","c","downClue","squareNumberStyle","fontSize","marginLeft","marginTop","squareValueStyle","width","height","map","row","j","backgroundColor","propTypes","object","isRequired","bool","func"],"mappings":"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","sourcesContent":["import React, { Fragment, Component } from 'react'\nimport PropTypes from 'prop-types'\nimport '../css/CrosswordBoardApp.css'\nimport SquareSelection from '../libs/SquareSelection.js'\nimport CrosswordClueScroll from './CrosswordClueScroll.jsx'\nimport CrosswordKeyActions from '../libs/CrosswordKeyActions.js'\nimport api from '../libs/api.js'\n\nclass CrosswordBoardApp extends Component {\n    constructor (props) {\n        super(props)\n\n        this.acrossClues = this.props.crossword.acrossClues.sort((c1, c2) => (c1.number > c2.number) ? 1 : -1)\n        this.downClues = this.props.crossword.downClues.sort((c1, c2) => (c1.number > c2.number) ? 1 : -1)\n        this.clueRefMap = this.props.crossword.clueRefMap\n        this.board = this.props.crossword.board\n        let currentSelection = new SquareSelection(\n            this.props.crossword.board.selection.rowCoord,\n            this.props.crossword.board.selection.colCoord,\n            this.props.crossword.board.selection.direction\n        )\n\n        this.state = {\n            currentSelection: currentSelection,\n            grid: this.board.grid,\n            lastSavedGrid: this.board.grid\n        }\n\n        this.clueClicked = this.clueClicked.bind(this)\n        this.boardSquareClicked = this.boardSquareClicked.bind(this)\n\n        this.getSelectedSquares = this.getSelectedSquares.bind(this)\n        this.getReferencedSquares = this.getReferencedSquares.bind(this)\n        this.getSquaresOfClue = this.getSquaresOfClue.bind(this)\n        this.getSquareBackgroundColor = this.getSquareBackgroundColor.bind(this)\n\n        this.onKeyDown = this.onKeyDown.bind(this)\n    }\n\n    componentDidMount () {\n        console.log(\"Crossword Board App is Mounting...\")\n        document.addEventListener(\"keydown\", this.onKeyDown, false);\n    }\n\n    componentWillUnmount () {\n        console.log(\"Crossword Board App is Unmounting...\")\n        document.removeEventListener(\"keydown\", this.onKeyDown, false);\n        // save state of grid\n        const { currentSelection, grid } = this.state\n        this.board.selection.rowCoord = currentSelection.coords[0]\n        this.board.selection.colCoord = currentSelection.coords[1]\n        this.board.selection.direction = currentSelection.direction\n        this.saveGridState(this.board)\n    }\n\n    async saveGridState (board) {\n        let response\n        let requestSuccess = false\n        try {\n            console.log('Saving crossword state...')\n            console.log(this.board)\n            response = await api.crosswordIsComplete(this.props.crossword.id, \"ME\", this.board)\n            console.log(response)\n            requestSuccess = response.status === 200\n        } catch (error) {\n            requestSuccess = false\n        }\n\n        if (!requestSuccess) {\n            console.log(\"Unable to save state of crossword\")\n        } else {\n            this.setState({\n                lastSavedGrid: this.state.grid\n            })\n        }\n    }\n\n    async crosswordIsComplete (showNotComplete) {\n        let response\n        let requestSuccess = false\n        try {\n            console.log('Checking whether crossword is finished...')\n            console.log(this.board)\n            response = await api.crosswordIsComplete(this.props.crossword.id, \"ME\", this.board)\n            console.log(response)\n            requestSuccess = response.status === 200\n        } catch (error) {\n            requestSuccess = false\n        }\n\n        if (requestSuccess) {\n            if (response.data) {\n                this.props.crosswordFinished()\n            } else {\n                if (showNotComplete) {\n                    this.props.crosswordUnfinished()\n                }\n            }\n        }\n    }\n\n    onKeyDown (event) {\n        console.log(event)\n        // if special key pressed, allow default action\n        if (event.ctrlKey || event.altKey || event.metaKey) {\n            return\n        }\n        event.preventDefault()\n        if (this.props.typingDisabled) {\n            return\n        }\n        let selection = this.state.currentSelection\n        if (event.which === 13 || event.which === 9) {\n            // enter or tab\n            selection = CrosswordKeyActions.tabOrEnter(this.state.grid, selection, event.shiftKey, this.acrossClues, this.downClues)\n        } else if (event.which === 8) {\n            // delete\n            selection = CrosswordKeyActions.delete(this.state.grid, selection)\n        } else if (event.which === 37) {\n            // left arrow\n            selection = CrosswordKeyActions.leftArrow(this.state.grid, selection)\n        } else if (event.which === 38) {\n            // up arrow\n            selection = CrosswordKeyActions.upArrow(this.state.grid, selection)\n        } else if (event.which === 39) {\n            // right arrow\n            selection = CrosswordKeyActions.rightArrow(this.state.grid, selection)\n        } else if (event.which === 40) {\n            // down arrow\n            selection = CrosswordKeyActions.downArrow(this.state.grid, selection)\n        } else {\n            let gridWasFull = CrosswordKeyActions.gridIsFull(this.state.grid)\n            if (event.which >= 65 && event.which <= 90) {\n                // a to z\n                selection = CrosswordKeyActions.alphaNumeric(this.state.grid, selection, event.key.toUpperCase())\n            } else if (event.which >= 48 && event.which <= 57) {\n                // 0 to 9 or the symbols on the same keys\n                selection = CrosswordKeyActions.alphaNumeric(this.state.grid, selection, event.key)\n            } else if (event.which >= 186 && event.which <= 222) {\n                // various symbols that we want to allow in case of special themed puzzle\n                // disallow the underscore because it is reserved for black squares\n                if (event.key === \"_\") {\n                    return\n                }\n                selection = CrosswordKeyActions.alphaNumeric(this.state.grid, selection, event.key)\n            }\n            if (CrosswordKeyActions.gridIsFull(this.state.grid)) {\n                this.crosswordIsComplete(!gridWasFull)\n            }\n        }\n        this.setState({\n            currentSelection: selection\n        })\n    }\n\n    clueClicked (clue) {\n        let coords = CrosswordKeyActions.getFirstEmptySpace(this.state.grid, clue)\n        if (coords === null) {\n            coords = [clue.rowCoord, clue.colCoord]\n        }\n        let selection = this.state.currentSelection\n        selection.coords = coords\n        selection.direction = clue.direction\n        this.setState({\n            currentSelection: selection\n        })\n    }\n\n    boardSquareClicked (square) {\n        if (square.value === \"_\") {\n            return\n        }\n        let selection = this.state.currentSelection\n        if (square.rowCoord === selection.coords[0] && square.colCoord === selection.coords[1]) {\n            selection.flipDirection()\n        } else {\n            selection.coords = [square.rowCoord, square.colCoord]\n        }\n        this.setState({\n            currentSelection: selection\n        })\n    }\n\n    getSelectedSquares (selection) {\n        const coords = selection.coords\n        const direction = selection.direction\n        let boardSquare = this.state.grid[coords[0]][coords[1]]\n        let selectedCoordList = []\n        if (direction === \"Across\") {\n            let clue = this.acrossClues.find(clue => clue.number === boardSquare.acrossClueNum)\n            selectedCoordList = selectedCoordList.concat(this.getSquaresOfClue(clue))\n        } else {\n            let clue = this.downClues.find(clue => clue.number === boardSquare.downClueNum)\n            selectedCoordList = selectedCoordList.concat(this.getSquaresOfClue(clue))\n        }\n        return selectedCoordList\n    }\n\n    getReferencedSquares (selection) {\n        const coords = selection.coords\n        const direction = selection.direction\n        let selectedCoordList = []\n        if (direction === \"Across\") {\n            let clueNum = this.state.grid[coords[0]][coords[1]].acrossClueNum\n            let clueKey = \"A\" + clueNum\n            if (clueKey in this.clueRefMap) {\n                for (let key of this.clueRefMap[clueKey]) {\n                    let clue\n                    if (key.substring(0,1) === \"A\") {\n                        clue = this.acrossClues.find(clue => clue.number.toString() === key.substring(1,key.length))\n                    } else {\n                        clue = this.downClues.find(clue => clue.number.toString() === key.substring(1, key.length))\n                    }\n                    selectedCoordList = selectedCoordList.concat(this.getSquaresOfClue(clue))\n                }\n            }\n        } else {\n            let clueNum = this.state.grid[coords[0]][coords[1]].downClueNum\n            let clueKey = \"D\" + clueNum\n            if (clueKey in this.clueRefMap) {\n                for (let key of this.clueRefMap[clueKey]) {\n                    let clue\n                    if (key.substring(0,1) === \"A\") {\n                        clue = this.acrossClues.find(clue => clue.number.toString() === key.substring(1,key.length))\n                    } else {\n                        clue = this.downClues.find(clue => clue.number.toString() === key.substring(1, key.length))\n                    }\n                    selectedCoordList = selectedCoordList.concat(this.getSquaresOfClue(clue))\n                }\n            }\n        }\n        return selectedCoordList\n    }\n\n    getSquaresOfClue (clue) {\n        const [firstRow, firstCol] = [clue.rowCoord, clue.colCoord]\n        let coordList = []\n        if (clue.direction === \"Across\") {\n            for (let i = firstCol; i < firstCol + clue.answerLength; i++) {\n                coordList.push([firstRow, i].toString())\n            }\n        } else {\n            for (let i = firstRow; i < firstRow + clue.answerLength; i++) {\n                coordList.push([i, firstCol].toString())\n            }\n        }\n        return coordList\n    }\n\n    getSquareBackgroundColor (square, selection, highlightedSquares, referencedSquares) {\n        if (square.value === \"_\") return \"black\"\n        let thisSquareKey = [square.rowCoord, square.colCoord].toString()\n        if (highlightedSquares.includes(thisSquareKey)) {\n            if (thisSquareKey === selection.coords.toString()) {\n                return this.props.settings.colorScheme.colors[1]\n            } else {\n                return this.props.settings.colorScheme.colors[2]\n            }\n        } else if (referencedSquares.includes(thisSquareKey)) {\n            return this.props.settings.colorScheme.colors[0]\n        }\n        return \"white\"\n    }\n\n    render () {\n        const { currentSelection, grid } = this.state\n        let clueWidthPx = \"\" + (this.props.windowWidthPx - (this.props.boardWidthPx + 160) - 2) + \"px\"\n\n        const boardPx = this.props.boardWidthPx\n        const boardSize = this.props.crossword.board.grid.length\n        const rowPx = boardPx / boardSize\n        const squarePx = rowPx - 1\n\n        const highlightedSquares = this.getSelectedSquares(currentSelection)\n        const referencedSquares = this.getReferencedSquares(currentSelection)\n\n        const acrossClue = this.acrossClues.find(c => c.number === grid[currentSelection.coords[0]][currentSelection.coords[1]].acrossClueNum)\n        const downClue = this.downClues.find(c => c.number === grid[currentSelection.coords[0]][currentSelection.coords[1]].downClueNum)\n\n        let squareNumberStyle = {\n            fontSize: `${boardSize > 15 ? \"6pt\" : `${boardSize > 9 ? \"9pt\" : \"16pt\"}`}`,\n            marginLeft: `${boardSize <= 9 ? \"5px\" : \"\"}`,\n            marginTop: `${boardSize <= 9 ? \"4px\" : \"\"}`\n        }\n        let squareValueStyle = {\n            width: squarePx,\n            height: squarePx/2,\n            marginTop: squarePx*3/10,\n            fontSize: `${boardSize > 15 ? \"13pt\" : `${boardSize > 10 ? \"17pt\" : \"44pt\"}`}`\n        }\n\n        if (boardPx > 700) {\n            // handle bigger board on large screens\n            squareNumberStyle[\"fontSize\"] = `${boardSize > 15 ? \"10pt\" : `${boardSize > 10 ? \"13pt\" : \"22pt\"}`}`\n            squareValueStyle[\"fontSize\"] = `${boardSize > 15 ? \"20pt\" : `${boardSize > 10 ? \"24pt\" : \"64pt\"}`}`\n        }\n\n        return (\n            <Fragment>\n                <div className=\"crossword-board-and-clues-wrapper\">\n                    <div className=\"crossword-board\" style={{ width : boardPx, height : boardPx }}>\n                        {grid.map( (row, i) =>\n                            <div key={i} style={{height : rowPx}}>\n                                {row.map( (square, j) => \n                                    <div key={j} className={\"crossword-square\"} onClick={() => { this.boardSquareClicked(square) }}\n                                            style={{width : squarePx, height : squarePx, \n                                                backgroundColor : this.getSquareBackgroundColor(square, currentSelection, highlightedSquares, referencedSquares)}}>\n                                        <div className=\"board-square-number\" style={squareNumberStyle}>\n                                            {grid[i][j].number > 0 ? grid[i][j].number : \"\"}</div>\n                                        <div className=\"board-square-value\" style={squareValueStyle}>\n                                            {square.value === \"\" || square.value === '_' ? '' : square.value}\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n\n                        )}\n                    </div>\n                    <div className=\"crossword-clue-section\" style={{width : clueWidthPx, height : boardPx}}>\n                        <CrosswordClueScroll \n                            listTitle={\"Across\"}\n                            clueList={this.acrossClues}\n                            selectedClue={acrossClue}\n                            isMatchingDirection={currentSelection.direction === 'Across'}\n                            clueClicked={this.clueClicked}\n                            settings={this.props.settings}/>\n                        <CrosswordClueScroll \n                            listTitle={\"Down\"}\n                            clueList={this.downClues}\n                            selectedClue={downClue}\n                            isMatchingDirection={currentSelection.direction === 'Down'}\n                            clueClicked={this.clueClicked}\n                            settings={this.props.settings}/>\n                    </div>\n                </div>\n            </Fragment>\n        )\n    }\n}\n\nCrosswordBoardApp.propTypes = {\n    crossword: PropTypes.object.isRequired,\n    typingDisabled: PropTypes.bool.isRequired,\n    boardWidthPx: PropTypes.number.isRequired,\n    windowWidthPx: PropTypes.number.isRequired,\n    settings: PropTypes.object.isRequired,\n    crosswordFinished: PropTypes.func.isRequired,\n    crosswordUnfinished: PropTypes.func.isRequired\n}\n\nexport default CrosswordBoardApp"]},"metadata":{},"sourceType":"module"}